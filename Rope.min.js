var j=null;
(function(){function m(d,a){return function(){return d.apply(a,arguments)}}var i,l;l=function(){var d;for(d=1;Math.random()>0.7;)d++;return d};module.exports=i=function(d){if(!(this instanceof i))return new i(d);this.d={a:[],c:[]};this.length=0;d!=j&&this.insert(0,d);return this};i.prototype.each=function(d){var a,b;a=this.d.a[0];for(b=[];a;)d(a.b),b.push(a=a.a[0]);return b};i.prototype.toString=function(){var d;d=[];this.each(function(a){return d.push(a)});return d.join("")};i.prototype.search=function(d){var a,
b,c,e,f;if(typeof d!=="number")throw Error("position must be a number");if(!(0<=d&&d<=this.length))throw Error("pos "+d+" must be within the rope ("+this.length+")");a=this.d;c=Array(this.d.a.length);e=Array(this.d.a.length);if(a.a.length>0)for(b=f=a.a.length-1;f<=0?b<=0:b>=0;f<=0?b+=1:b-=1){for(;d>a.c[b];)d-=a.c[b],a=a.a[b];e[b]=d;c[b]=a}return[a,d,c,e]};i.prototype.insert=function(d,a){var b,c,e,f,g,k,h;if(typeof a!=="string")throw Error("inserted text must be a string");e=this.search(d);b=e[0];
g=e[1];f=e[2];k=e[3];h=function(d){var b,c,a;a=[];b=0;for(c=f.length;0<=c?b<c:b>c;0<=c?b+=1:b-=1)a.push(f[b].c[b]+=d)};if(b.b!=j&&b.b.length+a.length<512)b.b=b.b.slice(0,g)+a+b.b.slice(g),h(a.length),this.length+=a.length;else{e=m(function(b){var c,a,e;c=l();e={b:b,a:Array(c),c:Array(c)};for(a=0;0<=c?a<c:a>c;0<=c?a+=1:a-=1)a<this.d.a.length?(e.a[a]=f[a].a[a],f[a].a[a]=e,e.c[a]=b.length+f[a].c[a]-k[a],f[a].c[a]=k[a]):(e.a[a]=j,e.c[a]=this.length-d+b.length,this.d.a.push(e),this.d.c.push(d)),f[a]=e,
k[a]=b.length;if(c<f.length){a=c;for(e=f.length;c<=e?a<e:a>e;c<=e?a+=1:a-=1)f[a].c[a]+=b.length,k[a]+=b.length}d+=b.length;this.length+=b.length;if(i.e)return this.print()},this);if(b.b!=j&&b.b.length>g)c=b.b.slice(g),b.b=b.b.slice(0,g),h(-c.length),this.length-=c.length,i.e&&this.print();b=0;for(g=a.length;0<=g?b<g:b>g;b+=512)e(a.slice(b,b+512));c!=j&&e(c)}return this};i.prototype.del=function(d,a,b){var c,e,f,g,k,h;if(!(0<=(f=d+a)&&f<=this.length))throw Error("pos "+(d+a)+" must be within the rope ("+
this.length+")");b!=j&&(k=[]);i.e&&this.print();c=this.search(d);d=c[0];f=c[1];e=c[2];for(this.length-=a;a>0;){if(d.b==j||f===d.b.length)d=e[0].a[0],f=0;g=Math.min(a,d.b.length-f);if(g<d.b.length){k!=j&&k.push(d.b.slice(f,f+g));d.b=d.b.slice(0,f)+d.b.slice(f+g);c=0;for(h=e.length;0<=h?c<h:c>h;0<=h?c+=1:c-=1)c<d.a.length?d.c[c]-=g:e[c].c[c]-=g}else{b!=j&&k.push(d.b);c=0;for(h=e.length;0<=h?c<h:c>h;0<=h?c+=1:c-=1)c<d.a.length?(e[c].c[c]=e[c].c[c]+d.c[c]-g,e[c].a[c]=d.a[c]):e[c].c[c]-=g;d=d.a[0]}a-=
g}b!=j&&b(k.join(""));return this};i.prototype.substring=function(d,a){var b,c,e;if(!(0<=(b=d+a)&&b<=this.length))throw Error("pos "+(d+a)+" must be within the rope ("+this.length+")");c=this.search(d);b=c[0];d=c[1];e=[];for(b.b==j&&(b=b.a[0]);b&&a>0;)c=b.b.slice(d,d+a),e.push(c),d=0,a-=c.length,b=b.a[0];return e.join("")}}).call(this);