var j=null;
(function(){function m(b,a){return function(){return b.apply(a,arguments)}}var i,l;l=function(){var b;for(b=1;Math.random()>0.7;)b++;return b};module.exports=i=function(b){if(!(this instanceof i))return new i(b);this.d={a:[],c:[]};this.length=0;b!=j&&this.insert(0,b);return this};i.prototype.each=function(b){var a,d;a=this.d.a[0];for(d=[];a;)b(a.b),d.push(a=a.a[0]);return d};i.prototype.toString=function(){var b;b=[];this.each(function(a){return b.push(a)});return b.join("")};i.prototype.search=function(b){var a,
d,c,e;if(typeof b!=="number")throw Error("position must be a number");if(!(0<=b&&b<=this.length))throw Error("pos "+b+" must be within the rope ("+this.length+")");a=this.d;c=Array(this.d.a.length);e=Array(this.d.a.length);if(a.a.length>0)for(d=a.a.length;d--;){for(;b>a.c[d];)b-=a.c[d],a=a.a[d];e[d]=b;c[d]=a}return[a,b,c,e]};i.prototype.insert=function(b,a){var d,c,e,f,g,k,h;if(typeof a!=="string")throw Error("inserted text must be a string");e=this.search(b);d=e[0];g=e[1];f=e[2];k=e[3];h=function(b){var c,
d,a,e;e=[];c=0;for(a=f.length;c<a;c++)d=f[c],e.push(d.c[c]+=b)};if(d.b!=j&&d.b.length+a.length<512)d.b=d.b.slice(0,g)+a+d.b.slice(g),h(a.length),this.length+=a.length;else{e=m(function(c){var d,a,e;d=l();e={b:c,a:Array(d),c:Array(d)};for(a=0;0<=d?a<d:a>d;0<=d?a++:a--)a<this.d.a.length?(e.a[a]=f[a].a[a],f[a].a[a]=e,e.c[a]=c.length+f[a].c[a]-k[a],f[a].c[a]=k[a]):(e.a[a]=j,e.c[a]=this.length-b+c.length,this.d.a.push(e),this.d.c.push(b)),f[a]=e,k[a]=c.length;if(d<f.length){a=d;for(e=f.length;d<=e?a<e:
a>e;d<=e?a++:a--)f[a].c[a]+=c.length,k[a]+=c.length}b+=c.length;this.length+=c.length;if(i.e)return this.print()},this);if(d.b!=j&&d.b.length>g)c=d.b.slice(g),d.b=d.b.slice(0,g),h(-c.length),this.length-=c.length,i.e&&this.print();d=0;for(g=a.length;d<g;d+=512)e(a.slice(d,d+512));c!=j&&e(c)}return this};i.prototype.del=function(b,a,d){var c,e,f,g,k,h;if(!(0<=(f=b+a)&&f<=this.length))throw Error("pos "+(b+a)+" must be within the rope ("+this.length+")");d!=j&&(k=[]);i.e&&this.print();c=this.search(b);
b=c[0];f=c[1];e=c[2];for(this.length-=a;a>0;){if(b.b==j||f===b.b.length)b=e[0].a[0],f=0;g=Math.min(a,b.b.length-f);if(g<b.b.length){k!=j&&k.push(b.b.slice(f,f+g));b.b=b.b.slice(0,f)+b.b.slice(f+g);c=0;for(h=e.length;0<=h?c<h:c>h;0<=h?c++:c--)c<b.a.length?b.c[c]-=g:e[c].c[c]-=g}else{d!=j&&k.push(b.b);c=0;for(h=e.length;0<=h?c<h:c>h;0<=h?c++:c--)c<b.a.length?(e[c].c[c]=e[c].c[c]+b.c[c]-g,e[c].a[c]=b.a[c]):e[c].c[c]-=g;b=b.a[0]}a-=g}d!=j&&d(k.join(""));return this};i.prototype.substring=function(b,a){var d,
c,e;if(!(0<=(d=b+a)&&d<=this.length))throw Error("pos "+(b+a)+" must be within the rope ("+this.length+")");c=this.search(b);d=c[0];b=c[1];e=[];for(d.b==j&&(d=d.a[0]);d&&a>0;)c=d.b.slice(b,b+a),e.push(c),b=0,a-=c.length,d=d.a[0];return e.join("")}}).call(this);