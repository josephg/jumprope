var j=null;
(function(){function n(b,d){return function(){return b.apply(d,arguments)}}var i,m;m=function(){var b;for(b=1;Math.random()>0.7;)b++;return b};module.exports=i=function(b){if(!(this instanceof i))return new i(b);this.d={a:[],c:[]};this.length=0;b!=j&&this.insert(0,b);return this};i.prototype.each=function(b){var d,c;d=this.d.a[0];for(c=[];d;)b(d.b),c.push(d=d.a[0]);return c};i.prototype.toString=function(){var b;b=[];this.each(function(d){return b.push(d)});return b.join("")};i.prototype.search=function(b){var d,
c,a,e;if(typeof b!=="number")throw Error("position must be a number");if(!(0<=b&&b<=this.length))throw Error("pos "+b+" must be within the rope ("+this.length+")");d=this.d;a=Array(this.d.a.length);e=Array(this.d.a.length);if(d.a.length>0)for(c=d.a.length;c--;){for(;b>d.c[c];)b-=d.c[c],d=d.a[c];e[c]=b;a[c]=d}return[d,b,a,e]};i.prototype.insert=function(b,d){var c,a,e,f,g,h,k;if(typeof d!=="string")throw Error("inserted text must be a string");e=this.search(b);c=e[0];g=e[1];f=e[2];h=e[3];k=function(b){var c,
d,a,e;e=[];c=0;for(a=f.length;c<a;c++)d=f[c],e.push(d.c[c]+=b)};if(c.b!=j&&c.b.length+d.length<512)c.b=c.b.slice(0,g)+d+c.b.slice(g),k(d.length),this.length+=d.length;else{e=n(function(c){var d,a,e;d=m();e={b:c,a:Array(d),c:Array(d)};for(a=0;0<=d?a<d:a>d;0<=d?a++:a--)a<this.d.a.length?(e.a[a]=f[a].a[a],f[a].a[a]=e,e.c[a]=c.length+f[a].c[a]-h[a],f[a].c[a]=h[a]):(e.a[a]=j,e.c[a]=this.length-b+c.length,this.d.a.push(e),this.d.c.push(b)),f[a]=e,h[a]=c.length;if(d<f.length){a=d;for(e=f.length;d<=e?a<e:
a>e;d<=e?a++:a--)f[a].c[a]+=c.length,h[a]+=c.length}b+=c.length;this.length+=c.length;if(i.e)return this.print()},this);if(c.b!=j&&c.b.length>g)a=c.b.slice(g),c.b=c.b.slice(0,g),k(-a.length),this.length-=a.length,i.e&&this.print();c=0;for(g=d.length;c<g;c+=512)e(d.slice(c,c+512));a!=j&&e(a)}return this};i.prototype.del=function(b,d,c){var a,e,f,g,h,k,l;if(!(0<=(g=b+d)&&g<=this.length))throw Error("pos "+(b+d)+" must be within the rope ("+this.length+")");c!=j&&(k=[]);i.e&&this.print();a=this.search(b);
b=a[0];g=a[1];f=a[2];for(this.length-=d;d>0;){if(b.b==j||g===b.b.length)b=f[0].a[0],g=0;h=Math.min(d,b.b.length-g);if(h<b.b.length){k!=j&&k.push(b.b.slice(g,g+h));b.b=b.b.slice(0,g)+b.b.slice(g+h);a=0;for(l=f.length;a<l;a++)e=f[a],a<b.a.length?b.c[a]-=h:e.c[a]-=h}else{c!=j&&k.push(b.b);a=0;for(l=f.length;a<l;a++)e=f[a],a<b.a.length?(e.c[a]=f[a].c[a]+b.c[a]-h,e.a[a]=b.a[a]):e.c[a]-=h;b=b.a[0]}d-=h}c!=j&&c(k.join(""));return this};i.prototype.substring=function(b,d){var c,a,e;if(!(0<=(c=b+d)&&c<=this.length))throw Error("pos "+
(b+d)+" must be within the rope ("+this.length+")");a=this.search(b);c=a[0];b=a[1];e=[];for(c.b==j&&(c=c.a[0]);c&&d>0;)a=c.b.slice(b,b+d),e.push(a),b=0,d-=a.length,c=c.a[0];return e.join("")}}).call(this);